# Meerkat (mrkt)  command-line

This is a commandline line tool that help you to work with AI libraries to support development.

## Installation

1. Run the setup script:
   ```bash
   ./init_py.sh
   ```

2. (Optional) To use `mrkt` globally, create a symlink:
   ```bash
   sudo ln -s $(pwd)/mrkt /usr/local/bin/mrkt
   ```

   Or add this directory to your PATH in your `~/.zshrc` or `~/.bashrc`:
   ```bash
   export PATH="$PATH:/Users/gap/Workspace/scripts/mrkt"
   ```

3. Test the installation:
   ```bash
   ./mrkt --help
   ```

## Usage

Usage: `mrkt command ...`

| Commands | Description                                                              |
| -------- | ------------------------------------------------------------------------ |
| `start ` | create a breanch and push them to origin                                 |
| `save  ` | do commit with message generated by AI                                   |
| `update` | create a commit message with AI about the diff and push to origin/branch |
| `help  ` | show the helper explaining how to use the commands                       |

| Global Optional arguments | Description                   |
| ------------------------- | ----------------------------- |
| `--quiet  `               | Only error messages are print |
| `--verbose`               | show all messages             |

## Commands details

| arguments syntax | Description        |
| ---------------- | ------------------ |
| `[]`             | Optional arguments |
| `<>`             | Required arguments |

### START

How it works:

- Usage: `mrkt start [feat|hotfix|release] <branch-name> [optional_argument]`.
- Only one argument is acceptable. Except `--quiet`. Example:
    - `mrkt start --quiet --no-prefix my-branch`
    - `mrkt start --quiet --no-prefix`
    - `mrkt start --quiet feat`
    - `mrkt start --hotfix`

The table bellow list the arguments:

| Argument            | Description                                                                                     | Default             |
| ------------------- | ----------------------------------------------------------------------------------------------- | ------------------- |
| `feat             ` | use feature as prefix                                                                           |                     |
| `hotfix           ` | use hotfix as prefix                                                                            |                     |
| `release          ` | use release as prefix                                                                           |                     |
| `<branch-name>`     | uses as branch name                                                                             | current branch name |
| `--prefix=<string>` | define the prefix to be used                                                                    |                     |
| `--no-prefix      ` | Don't add prefix. It ignores any prefix defined, even by other argument or environment variable |                     |

### SAVE

#### How it works

Basically it runs some git commands and create the git commit message using AI.

**First**

It add all files to stage by running: `git add . `

**Second**

It run the AI cli to generate the commit message. Then, do the commit with the message generated.

`git commit -m $AI_message`

#### How to use it 

- Usage: `mrkt save <optional_args>`
- Should accept only one argument, except `--wip` and `--quiet`. 
    - Examples:
        - `mrkt save --wip --rebase --quiet`
        - `mrkt save --merge`
        - `mrkt save`
        - throws error: `mrkt save --rebase --merge`


| Argument              | Description                                                                     |
| --------------------- | ------------------------------------------------------------------------------- |
| `no argument`         | Commit all changes and push on branch                                           |
| `--wip      `         | Add WIP in the title of the message                                             |
| `--rebase   `         | It will rebase before create the commit and push to origin                      |
| `--merge     `        | It will merge main into the branch before commit and push to origin             |
| `--story=<path_file>` | It will pass the story definition file to be used as context among the git diff |

### UPDATE

#### How it works

This command do the same as `SAVE` but also push to the origin.

Basically it runs some git commands and create the git commit message using AI.

**First**

It add all files to stage by running: `git add . `

**Second**

It run the AI cli to generate the commit message. Then, do the commit with the message generated.

`git commit -m $AI_message`

**Third**

If no option was sent, it runs the push to the origin branch with: `git push origin $(current_branch)`.

If any option was defined, it runs the option operation before the push.

#### How to use it

- Usage: `mrkt update <optional_args>`
- Should accept only one argument, except `--wip` and `--quiet`. 
    - Examples:
        - `mrkt update --wip --rebase --quiet`
        - `mrkt update --merge`
        - `mrkt update`
        - throws error: `mrkt update --rebase --merge`

| Argument              | Description                                                                          |
| --------------------- | ------------------------------------------------------------------------------------ |
| `no argument`         | Commit all changes and push on branch                                                |
| `--wip      `         | Add WIP in the title of the message                                                  |
| `--close    `         | It will commit the changes and merge/rebase/squash on main branch. Depends of config |
| `--rebase   `         | It will rebase before create the commit and push to origin                           |
| `--merge     `        | It will merge main into the branch before commit and push to origin                  |
| `--story=<path_file>` | It will pass the story definition file to be used as context among the git diff      |

## CONFIGURATIONS

There are some environment variables that can customize the cli.

For local settings:  
Create `.meerkatrc` in the root of the project (at the same level of the `.git` folder).

| NAME                    | Description                                                                 | Default   |
| ----------------------- | --------------------------------------------------------------------------- | --------- |
| `MRKT_AGENT`            | Agent name that will run the cli                                            | `copilot` |
| `MRKT_AGENT_PATH`       | Path of cli executable. If defined will overide the `MRKT_AGENT` definition |           |
| `MRKT_PREFIX`           | Default prefix used when create branchs                                     | `mrkt`    |
| `MRKT_PREFIX_SEPARATOR` | Default string to be added after prefix                                     | `/`       |
| `MRKT_ALWAYS_QUIET`     | Always run in quiet mode. Can be ignored if `--verbose is passed`           | `false`   |
| `MRKT_NO_VERIFY`        | set `--no-verify` to commits and push                                       | `false`   |
| `MRKT_NO_VERIFY_COMMIT` | set `--no-verify` to commits. Override `MRKT_NO_VERIFY`                     | `false`   |
| `MRKT_NO_VERIFY_PUSH`   | set `--no-verify` to push. Override `MRKT_NO_VERIFY`                        | `false`   |


## Development

Techstack:

- Python 3.14.0
- venv
- argparse
    - To define the arguments
- Code standards:
    - pep8
- Linter:
    - flake8
